<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CwaWeather 前端範例</title>
  <style>
    body { font-family: Arial, "Noto Sans TC", "Microsoft JhengHei"; padding: 16px; }
    .controls { margin-bottom: 12px; }
    input { padding: 6px; font-size: 16px; }
    button { padding: 6px 10px; font-size: 16px; }
    #result { margin-top: 12px; white-space: pre-wrap; }
    .error { color: red; }
  </style>
</head>
<body>
  <h1>CwaWeather 範例</h1>

  <div class="controls">
    <label for="cityInput">城市：</label>
    <input id="cityInput" type="text" value="臺北市" />
    <button id="fetchBtn">取得天氣</button>
  </div>

  <div id="result">請按「取得天氣」或更改城市後再按。</div>

  <script>
    // ✅ 修正要點：
    // 1) API_BASE_URL 只留到主機（不要包含 /api/weather）
    // 2) 在呼叫時組出完整路徑，並用 encodeURIComponent(city) 處理中文或特殊字元
    const API_BASE_URL = "https://cwaweather-test.zeabur.app"; // ← 只到主機根
    const DEFAULT_CITY = "臺北市";

    const cityInput = document.getElementById("cityInput");
    const fetchBtn = document.getElementById("fetchBtn");
    const resultDiv = document.getElementById("result");

    async function fetchWeather(city) {
      // 在呼叫時組成最終 URL（避免重複 /api/weather）
      const API_URL = `${API_BASE_URL}/api/weather/${encodeURIComponent(city)}`;

      resultDiv.textContent = `正在取得 ${city} 的天氣資料...\n請求: ${API_URL}`;

      try {
        const resp = await fetch(API_URL, { method: "GET" });
        if (!resp.ok) {
          const text = await resp.text().catch(() => "");
          resultDiv.innerHTML = `<div class="error">伺服器回傳錯誤：${resp.status} ${resp.statusText}\n${text}</div>`;
          return;
        }

        const data = await resp.json();
        // 顯示 JSON（需要更友善呈現時再調整）
        resultDiv.textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        resultDiv.innerHTML = `<div class="error">網路或其他錯誤：${err.message || err}</div>`;
      }
    }

    fetchBtn.addEventListener("click", () => {
      const city = (cityInput.value || DEFAULT_CITY).trim();
      if (!city) {
        resultDiv.innerHTML = '<div class="error">請輸入城市名稱</div>';
        return;
      }
      fetchWeather(city);
    });

    window.addEventListener("load", () => {
      cityInput.value = DEFAULT_CITY;
      fetchWeather(DEFAULT_CITY);
    });
  </script>
</body>
</html>